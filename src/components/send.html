<div class="helper-send-container step-{{ctrl.step}}" ng-class="{true:'show',false:'hide'}[!!ctrl.show]">
    <h1 class="head">
        <button ng-click="ctrl.show = false" class="pull-right close h-btn h-btn-link">×</button>
        群发信息
    </h1>

    <div class="body">
        <ul class="steps">
            <li class="item current" ng-class="{current:ctrl.step === 1, done:ctrl.step > 1}">
                <span>输入内容</span>
            </li>
            <li class="item" ng-class="{current:ctrl.step === 2, done:ctrl.step > 2}">
                <span>选择联系人</span>
            </li>
            <li class="item" ng-class="{current:ctrl.step === 3, done:ctrl.step > 3}">
                <span>确认发送</span>
            </li>
        </ul>

        <!-- steps -->
        <ul class="h-scene scene{{ctrl.step}}">
            <!-- step1 -->
            <li>
                <div ng-style="{'margin-top': ctrl.isWxFaceShowed && '165px'}" class="editor-container">
                    <!-- render from JS -->
                </div>

                <div class="footer text-right">
                    <button ng-click="ctrl.toNext(2);" class="h-btn">下一步</button>
                </div>
            </li>

            <!-- step2 -->
            <li>
                <div class="content">
                    <!-- 待选 -->
                    <div class="transfer">
                        <button class="h-btn h-btn-xs pull-right">⭐️ 自动分组
                        </button>
                        <ul class="nav nav-underline">
                            <li ng-class="{active:ctrl.contactTab === 1}">
                                <a ng-click="ctrl.changeContactTab(1)" href="javascript:">联系人</a>
                            </li>
                            <li ng-class="{active:ctrl.contactTab === 2}">
                                <a ng-click="ctrl.changeContactTab(2)" href="javascript:">讨论组</a>
                            </li>
                            <li ng-class="{active:ctrl.contactTab === 3}">
                                <a ng-click="ctrl.changeContactTab(3)" href="javascript:">我的分组</a>
                            </li>
                        </ul>

                        <div class="h-scene scene{{ctrl.contactTab}}">
                            <!-- 联系人 -->
                            <section>
                                <div class="tool-bar">
                                    <label class="cursor-pointer" ng-click="ctrl.contactsChecker.allCheck()">
                                        <i ng-class="{true:'web_wechat_choose_green', false:'web_wechat_choose_wireframe'}[ctrl.contactsChecker.isAllChecked]">
                                        </i>
                                        {{ctrl.airScrollContacts.sourceItems.length}}条
                                    </label>
                                    <input ng-model="ctrl.contactKey"
                                           ng-change="ctrl.filterList(ctrl.contactKey, 'airScrollContacts','contacts')"
                                           type="text" placeholder="输入任意内容搜索">
                                    <i class="addchat_searchicon"></i>
                                </div>


                                <ul class="item contacts">
                                    <li ng-click="ctrl.contactsChecker.check(item,!item._checked)"
                                        ng-repeat="item in ctrl.airScrollContacts.items track by item.UserName">
                                        <i ng-class="{true:'web_wechat_choose_green', false:'web_wechat_choose_wireframe'}[!!item._checked]"></i>
                                        <img class="img"
                                             ng-src="{{item.HeadImgUrl}}"
                                             alt="">
                                        <span title="{{item.RemarkName || item.NickName}}"
                                              ng-bind-html="trustAsHtml(item.RemarkName || item.NickName)">
                                        </span>
                                    </li>
                                </ul>
                            </section>

                            <!-- 讨论组 -->
                            <section>
                                <div class="tool-bar">
                                    <label class="cursor-pointer" ng-click="ctrl.chatroomsChecker.allCheck()">
                                        <i ng-class="{true:'web_wechat_choose_green', false:'web_wechat_choose_wireframe'}[ctrl.chatroomsChecker.isAllChecked]"></i>
                                        {{ctrl.airScrollChatrooms.sourceItems.length}}条
                                    </label>
                                    <input ng-model="ctrl.chatroomsKey"
                                           ng-change="ctrl.filterList(ctrl.chatroomsKey, 'airScrollChatrooms','chatrooms')"
                                           type="text" placeholder="输入任意内容搜索">
                                    <i class="addchat_searchicon"></i>
                                </div>

                                <ul class="item chatrooms">
                                    <li ng-click="ctrl.chatroomsChecker.check(item,!item._checked)"
                                        ng-repeat="item in ctrl.airScrollChatrooms.items track by item.UserName">
                                        <i ng-class="{true:'web_wechat_choose_green', false:'web_wechat_choose_wireframe'}[!!item._checked]"></i>
                                        <img class="img"
                                             ng-src="{{item.HeadImgUrl}}"
                                             alt="">
                                        <span title="{{item.RemarkName || item.NickName}}"
                                              ng-bind-html="trustAsHtml(item.RemarkName || item.NickName)">
                                        </span>
                                    </li>
                                </ul>
                            </section>

                            <!-- 分组 -->
                            <section>
                                <ul class="groups item">
                                    <li ng-click="ctrl.selectGroup(ctrl.groups.groups[key])"
                                        ng-repeat="(key,value) in ctrl.groups.groups">
                                        <span>
                                            {{key}}
                                            <span style="font-size: 80%"
                                                  class="text-muted">
                                            ({{value.length}}条)
                                            </span>
                                        </span>

                                        <button ng-click="ctrl.groups.del(key);$event.stopPropagation()"
                                                class="h-btn h-btn-link">×
                                        </button>
                                    </li>
                                </ul>
                            </section>
                        </div>
                    </div>

                    <!-- 已选 -->
                    <div class="transfer pull-right">
                        <ul class="nav nav-underline checked-list">
                            <li>
                                <button ng-disabled="!(ctrl.contactsChecker.checkedItems.length || ctrl.chatroomsChecker.checkedItems.length)"
                                        ng-click="ctrl.saveGroups()"
                                        class="h-btn h-btn-xs pull-right">保存为分组
                                </button>
                                <a href="javascript:">已选列表</a>
                            </li>
                        </ul>

                        <div class="tool-bar">
                            <label>
                                {{ctrl.chatroomsChecker.checkedItems.length +
                                ctrl.contactsChecker.checkedItems.length}}条
                            </label>
                            <input type="text" ng-model="ctrl.checkedKey" placeholder="输入任意内容搜索">
                            <i class="addchat_searchicon"></i>
                        </div>

                        <ul class="item">
                            <li ng-click="ctrl.chatroomsChecker.check(item,false)"
                                ng-repeat="item in ctrl.chatroomsChecker.checkedItems | filter:ctrl.checkedKey track by item.UserName">
                                <img class="img"
                                     ng-src="{{item.HeadImgUrl}}"
                                     alt="">
                                <span title="{{item.RemarkName || item.NickName}}"
                                      ng-bind-html="trustAsHtml(item.RemarkName || item.NickName)">
                                        </span>
                            </li>
                            <li ng-click="ctrl.contactsChecker.check(item,false)"
                                ng-repeat="item in ctrl.contactsChecker.checkedItems | filter:ctrl.checkedKey track by item.UserName">
                                <img class="img"
                                     ng-src="{{item.HeadImgUrl}}"
                                     alt="">
                                <span title="{{item.RemarkName || item.NickName}}"
                                      ng-bind-html="trustAsHtml(item.RemarkName || item.NickName)">
                                        </span>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="footer text-right">
                    <button ng-click="ctrl.toNext(1)" class="h-btn h-btn-link">上一步</button>
                    <button ng-disabled="!(ctrl.contactsChecker.checkedItems.length || ctrl.chatroomsChecker.checkedItems.length)"
                            ng-click="ctrl.toNext(3);ctrl.updateMsg()" class="h-btn">下一步
                    </button>
                </div>
            </li>

            <!-- step3 -->
            <li>
                <ul class="step3-container">
                    <li>
                        <label>发送内容:</label>
                        <div ng-bind-html="ctrl.model.msg" class="content">
                        </div>
                    </li>
                    <li>
                        <label>发送条数:</label>
                        <div class="content">
                            {{ctrl.chatroomsChecker.checkedItems.length +
                            ctrl.contactsChecker.checkedItems.length}}条
                        </div>
                    </li>
                    <li>
                        <label>发送间隔:</label>
                        <div class="content">
                            <label>
                                <input type="radio" ng-model="ctrl.sendIntervalType" value="off">
                                无间隔发送
                            </label>
                            <label>
                                <input type="radio" ng-model="ctrl.sendIntervalType" value="on"> 间隔
                                <input ng-model="ctrl.sendInterval"
                                       ng-click="ctrl.sendIntervalType = 'on'"
                                       type="number"> 毫秒
                            </label>
                        </div>
                    </li>
                    <li>
                        <label>预计耗时:</label>
                        <div class="content text-primary">
                            {{ctrl.forecastTime()}}
                        </div>
                    </li>
                </ul>

                <div class="footer text-right">
                    <button ng-click="ctrl.toNext(2)" class="h-btn h-btn-link">上一步</button>
                    <button ng-click="ctrl.toSend()" class="h-btn">确认发送</button>
                </div>
            </li>
        </ul>

    </div>
</div>
<div class="backdrop"></div>